<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Predator – SVG odpočet (ilustrační segmenty)</title>
  <style>
    :root {
      --bg: #0c0c12;
      --panel: #15151d;
      --ink: #d8d8de;
      --muted: #8c8c96;
      --accent: #ff3b3b; /* barva „rozsvícených“ segmentů */
      --off: #2a2a34;   /* barva zhasnutých segmentů */
      --frame: #3e3e4a; /* rámeček okének */
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--ink);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: grid; place-items: center;
    }
    .wrap { width: min(1100px, 96vw); padding: 28px 20px 36px; }
    h1 { font-size: 22px; margin: 0 0 8px; letter-spacing: .2px; }
    p.lead { margin: 0 0 18px; color: var(--muted); }

    .controls {
      display: grid; grid-template-columns: 1fr auto auto auto; gap: 10px; align-items: center;
      background: var(--panel); border-radius: 14px; padding: 12px; margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .controls label { color: var(--muted); font-size: 14px; }
    .controls input[type="number"],
    .controls select {
      appearance: none; border: 1px solid #2a2a34; background: #0f0f16; color: var(--ink);
      padding: 10px 12px; border-radius: 10px; min-width: 120px;
    }
    .controls .btn {
      cursor: pointer; padding: 10px 14px; border-radius: 12px; border: 1px solid #2a2a34;
      background: #13131b; color: var(--ink); transition: .15s ease; font-weight: 600; letter-spacing: .2px;
    }
    .controls .btn:hover { background: #191924; }
    .controls .btn.primary { background: #1c1013; border-color: #3d2024; color: #ffd1d1; }
    .controls .btn.primary:hover { background: #271015; }

    .stage {
      background: linear-gradient(180deg, #0f0f16, #0b0b10);
      border: 1px solid #22222b; border-radius: 16px; padding: 16px; overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02), 0 10px 30px rgba(0,0,0,.45);
    }

    .note { color: var(--muted); font-size: 13px; margin-top: 12px; }
    .muted { color: var(--muted); }

    .row { display: flex; gap: 10px; align-items: center; }
    .grow { flex: 1; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Predator – SVG odpočet (MM:SS)</h1>
    <p class="lead">Ilustrační rekonstrukce „radialních segmentů“ v 4 oknech. Čísla (MM:SS) se převádějí na segmentové glyfy a počítají dolů.</p>

    <div class="controls">
      <div class="row grow">
        <label for="sec">Start od&nbsp;(s):</label>
        <input id="sec" type="number" min="0" step="1" value="120" />
      </div>
      <select id="mode" title="Zobrazení">
        <option value="MMSS" selected>MM:SS</option>
        <option value="SSS">SSS (jen sekundy)</option>
      </select>
      <button class="btn primary" id="start">Start</button>
      <div class="row">
        <button class="btn" id="pause">Pauza</button>
        <button class="btn" id="reset">Reset</button>
      </div>
    </div>

    <div class="stage">
      <!-- SVG se vytvoří skriptem -->
      <svg id="predator" role="img" aria-label="Predator countdown display"
           width="100%" height="360" viewBox="0 0 1100 360" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>
    <p class="note">Pozn.: Mapa číslic → segmenty je <em>ilustrační</em> (neexistuje oficiální číselník). Segmenty jsou čáry od středu k 6 směrům: 90°, 30°, 330°, 270°, 210°, 150°.</p>
  </div>

  <script>
  // === Parametry kresby ===
  const ANGLES_DEG = [90, 30, 330, 270, 210, 150];
  const ON_COLOR = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#ff3b3b';
  const OFF_COLOR = getComputedStyle(document.documentElement).getPropertyValue('--off').trim() || '#2a2a34';
  const FRAME = getComputedStyle(document.documentElement).getPropertyValue('--frame').trim() || '#3e3e4a';

  // Proporční mapa číslic - počet segmentů odpovídá číslici
  // 0 = 0 segmentů, 1 = 1 segment, 2 = 2 segmenty, atd.
  // Se 6 segmenty lze zobrazit číslice 0-6 (celkem 7 stavů)
  const DIGIT_MAP = {
    0: [],                 // 0 segmentů
    1: [0],                // 1 segment (horní)
    2: [0,1],              // 2 segmenty (horní + pravý-horní)
    3: [0,1,2],            // 3 segmenty (horní + pravý-horní + pravý-dolní)
    4: [0,1,2,3],          // 4 segmenty (horní + pravá strana + spodní)
    5: [0,1,2,3,4],        // 5 segmentů (horní + pravá strana + spodní + levý-dolní)
    6: [0,1,2,3,4,5],      // 6 segmentů (všechny)
    7: [0,1,2,3,4,5],      // 6 segmentů (maximum)
    8: [0,1,2,3,4,5],      // 6 segmentů (maximum)
    9: [0,1,2,3,4,5]       // 6 segmentů (maximum)
  };

  // Pomocné – převod číslice na binární masku (6 bitů)
  function digitMask(d) {
    const segs = DIGIT_MAP[d] || [];
    return segs.reduce((m, idx) => (m | (1 << idx)), 0);
  }

  // Vytvoření „okna“ s jedním glyfem (6 paprsků z centra)
  function createWindow(svg, x, y, w, h, radius = 18) {
    const g = el(svg, 'g', { transform: `translate(${x} ${y})` });
    const rect = el(g, 'rect', {
      x: 0, y: 0, width: w, height: h, rx: radius, ry: radius,
      fill: '#1e1e26', stroke: FRAME, 'stroke-width': 2
    });
    // Skupina segmentů
    const segGroup = el(g, 'g', { transform: `translate(${w/2} ${h/2})` });
    const segments = [];
    const pad = 18; // vnitřní okraj
    const r = Math.min(w, h)/2 - pad;
    const thickness = Math.max(8, Math.round(r * 0.16));

    ANGLES_DEG.forEach((deg, i) => {
      const rad = deg * Math.PI / 180;
      const x2 = Math.cos(rad) * r;
      const y2 = -Math.sin(rad) * r;
      const line = el(segGroup, 'line', {
        x1: 0, y1: 0, x2: x2.toFixed(2), y2: y2.toFixed(2),
        stroke: OFF_COLOR, 'stroke-width': thickness, 'stroke-linecap': 'round'
      });
      segments.push(line);
      // koncová kapička
      const cap = el(segGroup, 'circle', { cx: x2.toFixed(2), cy: y2.toFixed(2), r: (thickness/2).toFixed(2), fill: OFF_COLOR });
      segments.push(cap); // udržujeme pořadí line/kapka pro každý paprsek
    });

    // API okna
    return {
      group: g,
      setMask(mask) {
        // pro každý segment (line+cap) nastav barvu
        for (let i = 0; i < ANGLES_DEG.length; i++) {
          const on = (mask >> i) & 1;
          const color = on ? ON_COLOR : OFF_COLOR;
          const line = segments[i*2];     // line
          const cap  = segments[i*2 + 1]; // circle
          line.setAttribute('stroke', color);
          cap.setAttribute('fill', color);
        }
      }
    };
  }

  // Pomocné pro tvorbu elementů
  function el(parent, name, attrs) {
    const n = document.createElementNS('http://www.w3.org/2000/svg', name);
    if (attrs) for (const k in attrs) n.setAttribute(k, attrs[k]);
    parent.appendChild(n); return n;
  }

  // Vytvoření celé tabule 4 okének
  const svg = document.getElementById('predator');
  const layout = { left: 24, top: 24, gap: 32, width: 1100-48, height: 360-48 };
  const winW = (layout.width - 3*layout.gap) / 4;
  const winH = layout.height;
  const windows = [];
  for (let i = 0; i < 4; i++) {
    const x = layout.left + i * (winW + layout.gap);
    const y = layout.top;
    windows.push(createWindow(svg, x, y, winW, winH));
  }

  // === Logika odpočtu ===
  let timer = null;
  let current = 120; // výchozí sekundy

  function secondsToDigits(sec, mode) {
    sec = Math.max(0, Math.floor(sec));
    if (mode === 'SSS') {
      const s = String(sec).padStart(3, '0');
      // Zobrazíme „ - s s s " -> pokud méně než 3 číslice, levé okénko prázdné
      const d = [' ', ...s.padStart(4, ' ')].slice(-4); // přesně 4 znaky
      return d.map(ch => (ch === ' ' ? null : Number(ch)));
    } else {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      const mm = String(m).padStart(2, '0');
      const ss = String(s).padStart(2, '0');
      return [Number(mm[0]), Number(mm[1]), Number(ss[0]), Number(ss[1])];
    }
  }

  // Zajímavá sekvence místo přímočarého odpočtu - spirálové mizení
  function getSpiralPattern(totalTime, currentTime) {
    const progress = (totalTime - currentTime) / totalTime;
    const patterns = [
      [0,1,2,3,4,5], // 6 - všechny
      [1,2,3,4,5],   // 5 - bez horního (mizí první)
      [2,3,4,5],     // 4 - bez horního a pravý-horní
      [3,4,5],       // 3 - zůstávají spodní a levá strana
      [4,5],         // 2 - jen levá strana
      [5],           // 1 - jen levý-horní
      []             // 0 - prázdný
    ];
    
    const patternIndex = Math.min(Math.floor(progress * patterns.length), patterns.length - 1);
    return patterns[patternIndex];
  }

  function render(sec) {
    const mode = document.getElementById('mode').value;
    const totalTime = Number(document.getElementById('sec').value) || 120;
    
    // Pro každé okno použij spirálové mizení
    for (let i = 0; i < 4; i++) {
      const pattern = getSpiralPattern(totalTime, sec);
      const mask = pattern.reduce((m, idx) => (m | (1 << idx)), 0);
      windows[i].setMask(mask);
    }
  }

  function startCountdown() {
    stopCountdown();
    const input = document.getElementById('sec');
    current = Math.max(0, Math.floor(Number(input.value) || 0));
    render(current);
    timer = setInterval(() => {
      current -= 1;
      if (current <= 0) {
        current = 0;
        render(current);
        stopCountdown();
        // volitelně: krátký záblesk všech segmentů
        flashAll();
        return;
      }
      render(current);
    }, 1000);
  }

  function stopCountdown() {
    if (timer) { clearInterval(timer); timer = null; }
  }

  function resetCountdown() {
    stopCountdown();
    const input = document.getElementById('sec');
    current = Math.max(0, Math.floor(Number(input.value) || 0));
    render(current);
  }

  function flashAll(duration = 450) {
    const fullMask = (1 << ANGLES_DEG.length) - 1; // 6 bitů -> 0b111111
    windows.forEach(w => w.setMask(fullMask));
    setTimeout(() => render(current), duration);
  }

  // Ovládání UI
  document.getElementById('start').addEventListener('click', startCountdown);
  document.getElementById('pause').addEventListener('click', stopCountdown);
  document.getElementById('reset').addEventListener('click', resetCountdown);
  document.getElementById('mode').addEventListener('change', () => render(current));
  document.getElementById('sec').addEventListener('change', () => resetCountdown());

  // První vykreslení
  render(current);
  </script>
</body>
</html>
